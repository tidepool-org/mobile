env:
  global:
    - secure: JwyUBKzZCPU7jsSJWwD0G8pcwloeiE2his9eHThJHxSqavdEvwtASioDSIVNGd84Ek/4AIcfI1PlGWgNbxzpkBi3UVJJJLkNiKxMWCjSzV7eIB13yyGS4qcnPNxMlWfDw/vx5aIUFS5KTZ1qO74YXXkL+Ol94JlwNay8BY4uMm7rX9n2c7eIoVV3IhVUvm9onuEjFFwJmMDgcrLaq+/BYp1HRFgD7adaC8cWeTgb82bBuAAyjalkxAiHZR9xQiv56NphjlGNGIo5qQVdIOqu4G71KWnVu+uDOuY9yBetIedxgvgRLnrUst7Anpc1d2TmRDihjggL0P4zVwWswqwSAcpCe5QuUKgfiBW1ZDHy4ciU82CEpLq/LMYFaYF0KWvdbMnenVddrEs30FMZPNQlk3Yytq+Bg4VsLRQFf/f4pEWptmNt58qxbOEym07OMAPxYuUx1+rRe7MfR2rRDKoPxeEqCQVePHS/Xdld2z78yeaqkbrkaTpYZRzC7McmLRDOSyr84j4K12X3LEO/O3YQvq+Yd+U8ZFPfUDc6YNx6DKVlNBVSfgUGLEdHjrVmbbZ5QwcgzCAG33bIgbcLMYtFp7GTZTzFDGxZvCzSI1n2pu3fryvcPVkCuTOJ3cp3xedTDM5xj8GT7YWDW2J2MVuCBAgfT3jCgN3fjwY8KTNbvMk=
    - secure: wIlE7Hffrd42d9XQxULktBfJfH0/kqIEp7m7Zwe48yvecQLh1+PQfmzO9aTDewAKiD5qqKjvlT/IWntiMcG+pcJK8t9/aDP76mz4rWV0f6paOfalhMMucyqLWT4x9lR4YJD234kHhJwkhyUDG/+ohWK0wqfsDSO0Kk08/uz/zj4Rq1NCrVnI4FJIaE0NbycriAb7ILBZ6v3OPvv1rcxEIzkXKN9/mYOcO6f7/gcGDKNLXPCGH/JuC8IbhYEd2vGOGih8cVJO1y3L2FkR2HqmMHE478M/xBQhsgXPAx8pTiXIbiOEOpe8fcpGHG6UTMiCEOCMA+pp+ODMj5zl8EU6xj+HhZWzTKbRDnXwvzY5Lqe7oVRmM/alI5rLgu7PgIV3TsUcyr2uLV9pswxLzLBwYVxyG+X4hbMGkJv2cyryn/pD0sTU9Qf+hEwfeK+WSIuXD48hxy1i02wQIHjM5S6gF+akbaXhQ/6xBMYEpFxR0gClaYfhg9I99Of81DfZcPBn5bIILbTdoNrQoXdG0CXFRERINzyf1obzQKBYDtuAf6ZaV1it0/3iDu961SWu+8vIttZwX1fjdfcTVkWxkCtfxbt35q9CxmPRAqOjHtTWFTvXisSmSt97QqJQ2CaSR8l8g9HOPu4KoGdyPNIIFcPwIrvsgCEpAlU1GqrHKE7svxo=
    - secure: YI50SskmUCCDJibPA6tZXJwpmMoKsw5QU+9v2XhO751tkwe2MuuLxqlE+UnbE4jrk7RMiM8UqYYvTC0XuA8G8Ue++4btid32kpAwaqqJRcsP7y/HSlVji21YeIxQIr+RIEDDVk2EH1ImbR/1SRdNzSjwPesfTVyIKNt6bzaloDtEXaCtaZz6dNVrkLM+Mw2Bb9ZQwtHPkODOeOz51c6BPZqpslVFK7mNtb8HQe+WUMqnEhpyNxLRMlqvfd9TNWLHQaIbgSqkep4AZKuKns26mv/zsYx5D1i76Lt2qDh5e2IUJyZqb2Cq+bwri/roUHD/nnMoTRrKFU6dioLjHL/l0QD84ib/xa8eYClmZ1o47BqL5OtBwcJvele4tWv6G99FanTfNPAgONqVjT1qq0bPBzu//tEgi8GhM38KsgxmgHHcU8noPqksPfXNbo8pET0067laX5D07iv8/whe5q7qb+Ci0ckxnj1fKhAlMHLU6xMkGSK5RCqHXViSM6JPfZWLFbnUWxN9BA88mqQG4zlsB8aPkh2oFwuXIaHZMuPw4SAyHPwYlGmxckreuCOCm6pXuHzpZ2ndOD+Ujtfs5T+QVFUESZr5aWJr53x/QhUiays3YPOQ+mi2pAcO0mBiyFs8Y9pPr83+f4svXkSWrA3hWBm4a0gqDgZaRICMDUiHE2M=
    - secure: 6wJztYDvUMfa+OHCawpQuxUOJeji+UpvzInN0RZfvDzqHtVz3DZLpK5MlLnOiArQQ+SjwCfL1/vmSpOXNlUOxfjVBvO8HtgmuhPJl3gZumrl8V/i+5DSVixkbqaj/l2viMnmxOb8O9JngWGhUzw3iVWe3des7CAtZxGDyVEBFkPp6HPsKAE2DdkFcFq1amdILJ3DWMDnu/TG904leolMCV5+BFFY+A8GazZj2m6ZGKVakDkFG1aehlgMS0zvTOOKYE6ib8AGFapuI+3wg+DxSiybo7tD8F1HOTgYFKfJ3T5PJQTlBEsMm7nUkSAwXI2Huxl9UxKP6lzwJEDrqta3xuKesV6QWrq77Slr25zJjNoc+VbuEyhLNdqObJeJGgXbP8IWhpuo8ixcKYemEwbBXQmFF2Q9Zfb7fVgjCcaFIbO27CDbhyu9JwrUH6Y0p+sbCxMlkDHlp2WnOOx9pD7A0XVjFXNBnyN6Hl5rCU/LP0jGsvCZZ5vTYQrYgBqKBnqF52/kNZSo4zlgGMC0YtjCXss1yEY0DVhIIIxPbNA3AFGqBtYrIMRPQ9pJwPbAvEbwubG+RfMjZQjGFxdExCfOmSY9eIcBrK04R5CA6avLt8m0bklgmZChkCP8uJ8iYMWOdx326p484P4wDF6M9p2Px+EWWSu9j1yAlIyj00ElTm4=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out ./android/release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease --debug"
        - "./gradlew signingReport"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
