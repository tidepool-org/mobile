env:
  global:
    - secure: 31lTb7l/06dQ6x1UXwnWTnqShzG/SyirTWkPiMVm5IyQR1yRbFFgpED9zu4x1IGl86eyrNypfAMHW6wKJgUsOCaI8ZEcSf32vs9iv50OVvI9f64eomDaA6QZ+HErGCD/K/FMfWehUnDFQXyhrAC7w4sk9iYwGvMsQ8EfhaWg/EarBP3dK5cRbflYJnOdimE4P9VJrGL1A9HhjdaEDy0hvzJ7rALSTTnAlbvxH5WrUEuN+G0iy96f2sLpKigHM63Ty3EdmjUzMl7wCE/odAZMjs0rrfOO038jAsMorfrJQJZkfl45f/XcqIN0ciVGP4cKd6qoURWzOkN5OSxnpuCJAKEBPWtNnSqZad6QS6+4xfgQkaBqZRKz4ZIrk+os8x+g8uC9LTY7DfyQ1Pv3xycd9X4TjA3BcpWeixbisBU1+v01UhsVTd1Jy9y3uayoa7+dPiVxPuTxWJoxK0fUwaiXxqJ8xr35cVqoirHuwNgOKppPkB0kTe7Zcs/fj1Ulj744lg78LdU1tw2Y1vwql98884AORVyJ31dFRDIuYlGE7NksgCzVn/ux1Gq278xhp7rnszvpet0uEqvIAyuRVcL4CDTmoD0eyI74C7HM98S5RxyANifGXku2IgxfNln/Okpchuxn1cEDzkvNQCd8nswYFEMCnzuIW7YL0jukPHBHiTw=
    - secure: E01BbI5ADqUo95I6Wv5TKzt5BWWMcruVeA/D7r5uX6Tpo+UUHrMjCyMzoTVDYZsqrNy0TzQg1jqxz7GHSwTCl2OXIyTCv6KhExhiROFoVExB7e5zosUKuzUYLfSYQzHl+U+ah58GUKba57OqKH5ZjHc1sEvUEGBSV8l+Vy6FIQALXbl818JQ+Zw0n9pn8W2mmzxW4c3Y3yGzwAmSuBwH5hG8h5ZxzOLSdoKVicqYfeBftzXodcvINl/d+2MYK7EdAsiqznsOa65q3o+eCuWkFaN9bAare1mqmOvGpjIZTkC6cZyI6FfY0ZTv1plBxved38OUMm7m1073yxEn/h5KB3z56DIvbyLLvQss5rEMdp1icowklbOZowJCC9H3RW3g/4hntPRg09zRz8PCTk6o7DLZx5TADD9mkBuIHEsiX90ZKgI7HTOv/7R/urHKJBRKCReWhqzg4C5fO4arpvUyieQirl6aqfgBJZJx6iIMjSffm3GefCzszJzQjXZOp0NHNAWpDppgguJ3j3MWYmVVGKAePFL8aoyzlc2bNvFioHRzg9B5m972u+JbA52CSaD8FDZyoA/oA8AxFYTa83YuMPhkKgLFHTab5hnW9qlnaWi73nqfgtefCzVOEi9UxXAszr3Ezx9NocZYrhsMHGHVNZW/LSwaWSu7elxNIhfJv2Y=
    - secure: Y9SrP+oWBRsk+HwFtMFkRAViB/FqigzARMaFtm6NFYliTQKgQ1EWrs+uO7JDTDePhGjX/t+qbigQiMjM4OozBK9fyYglHi8yuP2cClAluwtV5kXby5gqC/R5uiZgyKVCAvp2h2VXlfim89eZM8EJn+JzKNoPe6ufqna93gnkWTGruZPep3D5kLCePqLAXp33tttnjTuyOEpTZLA0LM2+GHNeXk96+IPbX/BlaKk7qZX5Myu/md1uxd8uMDxlSWaqz4vXjinSx/mmTTXslTzd4uBmbtLRZ2LOzrgeA6fuB/tmYoCRcva94amYYRLOzFUBExigMgVUsG1uIP18tYZ8duCqm0ve+kAYKamV8ChAbBMakSDgseBNB0tasSAmKL3HZtVEvXNm7l7s4hk74huLNAmRdsd5MDUWatunqwinecnfhyCC1YzXcnVkPWlFBN/gPnxactWyOx/77MUNN7xpc9TVQhmaoqagqmgWxrbmApdBeekEusH8mw2Nvjl/lzO+L6EGfsBL0TcBt8ZzT1so23HFRf9aFGr2vxJH3t/+4UlYXGcoTR5Rzxi063ktqXZiysaNnKk1OpmLgIgZUKagRAvrefCOtX5KiujQ40S422jtgpjpcOcY1Tp8FGokVGdBn8CR2K0+8p8YYWxAk/cXiSFckXdR1hfDnMvk/r2a1WU=
    - secure: N264oM4YJ6CCBSW9MJaPAWlaIEW9jDm1arq/51FQvSogBmwETmsLZkUF45O3GsNoy8tFEtmji6b+geFjUiiGhyG2zGsqDHqc42hIxHFvJVgQNkOp0eCSYJ3+thuD8Z83FdQuDedauYYzIUPVhgUsJqE1g4dGO8RXlar3p3PTXpL/prhkrNKjkhAEA0zQ0vlyAY/ziQ052b4ND+hFyInBFwA7+dMvtfdpy48UtnH96YUwQ/nzOWk9U5f9yC5To8/YSWhUBP7VRlzByvuhXSeHXIAY1KGIOjYXb8cj+8NdlXOat6Tzy0oTs7VG3vHQQTHqNOc8kr1l4ZFIeYfhia+98/7R9mQVAUlOViwtukrHaHtgYWp6MCXU7KZQV4W/smL/725hu1vIetET5VvZZX49ZMIsenm5a+hVzom9MJ1g5Hz51UY/cGaMZ/lteCObG3/BkSykiPuGpsS4T62ZXMJPoPQ6EonrnKcNSwCnMBv7JtYgcvPPQut2mqv2KsR3tKL0sdqni6+5aPaeXY6xwp6ZaIJQOGIXjWfcBNoQDFhyZpvj5Ubgi3IDMjlSdRVIsuS7KpIHx/PuoSAp3XEJYzGbQ9ahWOYCI+g7M39qNoGhi+clsUrARzL9RJSiEuyWoztPYrL6y5aotYG/gI9cLx49b1ZWEYbYWGgYJm3D1Drsrds=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
        - "./gradlew signingReport"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
