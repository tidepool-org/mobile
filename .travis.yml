env:
  global:
    - secure: gnQLe7sN2sRQICdwMi4Do/vtYCbmQOKUWK9f26mtpFkTyiP0NBTi+tm0zAZ9K6UbFrPWvQ7xDON/PgU//GfASUDoiQTzmzQMyV4lcEkhGAwNoSFtyPJ8IqzRVSSF+L2yzJzVuG56iJO2yu5Xho1GrBlHCIYti3xjvc9Vo9O32Afpc1Q4LpK9Uqf3db2bBVzyUrhaAZHmYiA4+Rpl8/HMOgam2lJ+S0TNfU1X/gpwSl8QhIMzM1AewL2MMsl+zYx0gzbc1pS/xworrq4IX1nGbbiLiQkgkafSyP/Zx9Urt/+bupvu5rvlvOuVJKa7alzZQhoRw9yy91aCWj2WoevnssE83iMBrH8qkbWl1ImCNLAHyEudxN9rZ7ITLxsexi+LPV5UyfPYNzWKS+pmABnG+fZSyis0WW6VZKafVFSgsd4PtuGiik9xbBKz4Slem0AVAkGpZCDoZTuhlX4/kgQv34Yi5pVzEI9KnbEv4bzAUSp6jSaTTJgyn+L8/Q5lj8XfwBXJd6nhjaMv7yl+KVyoMhYxgCgodFrYVz4ZdKoalzCOc2AK0sq6dFsHwPpZq9gyClPgD43adyFqUsfLj/rFr4P4op6jEK6YGfNzIqeXE+hOxPQKK86Nhic7Q9801SmJGxUFfpbgroBGx4qKVWcJq7prJwO1NxUrSMJPxt/VrlQ=
    - secure: hasuQhCKOdXv68vdQKil0AvNJn6DCJBSXnzlTS1cjGvVwW9BuvzbkQlaeTCPHH4IY0lAO78ffDHgzSn1ZzioL/3NDyc6uLEsUIxnwg4hd89XYsEQ8NdxjinasbEF0Z9W35PIeEaSesdS3zMXpV9PnnNb+3G0LRQPNUUpxI6PrlFGj8JPxcO/a+s6LnMNsgzxktVS8Z+lB4fP1C8rrP9EN4BHBGynm+FFcUIBslIFIOm9nG/UnJII+oDn2LIJzf0gk2xI/fuFGhZfTMAv4lKQFvFTi9J0nYv/NqC/lajrHKR+hz+bfwtqFW9lZsrPcY9PSPGx3pf6i9Bny10a/Rzdl7eHAunoAn3RYkQqbX4PEvnepNUAm1AFB/wN2fqBoFQi2aPlTT5VQkQYGw4/9MsC5yP1b+47uYhaL8A6mBCw0NjCTIj5Yv1gNsnDNr3Xnkvw98aU4hejgYZMy2yDZKX7IPpscG2BCGQ65pAGgJ4zjjyI2oxdw0GycqLCF7/7S/5s9xJYgnc/pOjvmoOyog+IygfzbnCqbltEVFmYgMbGCLIjSRvPyk3Tj/exztBUBdPWUU5OEqrnguoTGUFrfoqXoadPE7kUkqOxym/Pj/bAZ4GpZ09Epvz3DpugNJSk0ivaxqHeYbLTqQ449ufRhXHGxAhjRJhKmfw2rVO2P4BGKZI=
    - secure: 0jQMoIfCcKHM47CQbRZo/Mg35E7h+igFzRVNbmhtHk5aCgWavf5nIcMk/NKmGmmnUDyoJoLGJoyFtyrvdKs+wYgbZB3aP4GXhpchjlCEtSh4GOooFbX7CWZaToe42BLaywVumPGWUMtNhi78UKO3qttRou7YuHsnOKzlBQ0FWCjXlfenC4MXw+1jqrdWviEbSuPqqw4KZZbi9nr6NpPa3SI7rCrj23rY/bew+RPcCeb5gzPpjxgNRWRw0fF175Wl/uyb4imj+5BghL8uIvOfpZ4E3BORsKSc4FdHYrS1toh38DnsabwRBp4zn2f1/nVk6t4ZvB81BxttIPVqWz2WSbjKOXt6ulTDUMBqA/Vroo6vbuc9yHoQEHxc6mvd4Or/5r9pgEP7GOlYb74ZBFkfLvZq+XywhXQA3J7KUSEoynAwH82R/SHWF3su/YbZ9YCiU5crsGS2r5IZWdhTMYNxPX3eQUQCuOQNnuA0IJORQxhxUTRvd8cpbiQeI8qcOB9PmOJad+kSBaeRpTsGn26U+fSxjnRCC5hH8JqD7phpc2Dy4JbN+IFrCKB/JN/SFB9Jo8wDB7t77EPhzzsfYWClmwn1tvIIotF/Avc0QQ9khOCdfz3oGwgORH+eGzxzk80zzDNyyZgVNaixJPHrwgLVsnRhVQa6zByfFVjNRHjymf4=
    - secure: P6eAVn0yBJazsb6wJbjwWf6CW1Bz70LYiKESJn6O22OsOpiHCxrqwnTZPrPKw64MN7UHz9gRxOOWwT8u1XpS5TsT4odZJ0bEV3RdWczi8Jlz7clUYSE4jwJzN2cqaUcGSqUmfVjzmefMozlzyotmF1OWOlDwIS55x66wRZmr17/jcUcyWDWG3kWKMFklVP0yGbcc60q1CssVARCHyJfqFPqc4ZQnoYaunRbaLGQR2etE6Hqa1nmcuurJQgb65moI5tdU8xOKWTCauBk5rcDh9Dr5GcW1D+GaAEjYe6wtidtxiycDn/vBkMXiYgkxBDuGuKBarMy77OfoW54MOvwXVvAaLtZJO0y5AH3TvJWlLARe8AXsrWQq+k0JHLdZktKt2E7D4wlpKKsFX0ryLN6fAng/TMFT1e4iUGxLLEuzimUg23CtIJP2VF+DUuuayKe72upjZlRSYd4vCVex+vDjoX3iLhN7udPX5SEGqZbSa1Et8FtebAIMJUdUnkHk5MWzYbRGkSyQT6YgHdm75eohmrlz2qzQIJRUqYb3vSf94HVf7YpIL1w3uOlUDlmSK2C3ou1/oF4jZe4lFao95o8LlaTiDf2SWJ+X62LT4KYhSyYwMIxGcUduxKPbrLhJ/7HVFKRL/c9t+8O9YtXihYQwX+JwB1A5vs+/Pxn5pFVr4Nk=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
        - "./gradlew signingReport"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
