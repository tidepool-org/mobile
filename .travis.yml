env:
  global:
    - secure: 5huaMR4sC3OkRhUXCA2crEckh7d7t0wXwMg8J/lwLM77l36uWSaigXeHRPHmSSK1kNkEQmvPkIzlME9LIJOa/7yf8jwr2FhdGP/cJJoOM7KdETiUaPr17QzzCrxl6yZsEYR6V2/sNHccR1npkt5wLiI533r8glAzXFips8TqVxPsFn9gmcujzK3gnqjjU4nim84jeQyrFcGf9niZFy+E7ZW5JpHBN7aMty0/jjMEFyN/EN3Gyf+6R2jMIaKRA2L25kGPpYiYsJhXVzh0tHVt97fu9iTqsKca/1G/OUPNL2X9ny92YGSHO1bumnllBZ9Hl7mLNqmAZCfMc28W7z/MdhVfQu3yq/GiLaAqPh0fFdko42cwzNNjujvmzaLfonXbpZvIxYd2ktKoPKXh/wvK+M/0G+199p7nqGCUZsr28pMqAEqbiwEpocYxM3yAFK8HLLTQMPeRRG5CuLBeIgh8rzXs6bJzFb/sLHiekIhqgTn5g1KBPNsrY7vheTJNIEevA4PLrQJPBDBscBv43LnbGqxdPJPP8FniNQ200ENeh80TG3G/Q/X9m5HpgN8XiNElMkOcrD4GdOZvCRkcNFdps6wQcDtEJvxV4BdkJPcDVXQJysKFy6x46QeRiixOBs81TT9R+scU1Z192XNHwL2lyKW5jg0ORUDhqaG+x+N3gNU=
    - secure: NeWXvxOpjckS2nRCJ9qFrkVO/tHy21IUfcZ0K8oE8jo2NZhgLgrJZABUMHbBOfTx33jXY/dPDn4prsvM80O2hZPJFQvLa8JSBAMtOvIFp0+KLBdoaFR1jjHjLmpIDVKzx5KOHFjA+MEEZ340eWnCeubEB0T871fvCRVfWYX341SD8CqmiLCj4Cl6Shjz1HSke2OFUedTUyzRPL6Zoa9ebjbsnMf+Xv2b/TQlpZkxDqNsdpxYoKRM1hYeMv6sUyxvztetycqQOcTSs7Scn6D+k+zNJC+34AsbM0bB8s9bELNy67SZwVzxFzkj9jhEHyNmKFcsGzNLceLixZWqz4aGWFxMvo7tO/jMJIorAfyH4YcJE1CCkiwx4wUVV4cFvwFG35WREfinL+D6VOglyAsayyQWdocDJZL12V+nYxaMLS9BB4dmIO0h64VNYRRaBUt0rZX01ACgNxjmAd4n8MWP4Db3gAdYgXuSxrGSH5hleTtyQEw2AbSqr4THUDz+g0bmcHCpgcqwRh0g41ImTF9IgSGeQ2AkENCTe9qlwKFwjyBWEBqAwtZlzlB26s1amXF0xQ7zNSaMRMVeGeeOlTqMpENPnoK8JTDZO3ykssiZN1v8FDNQKBp3K8Kacg8vqoDBD3qkafVjtJ2jmuZSqjggcAP5Vh70sAAXY+qrs+NAv4E=
    - secure: jLCxhWOuMEukI489oFa2FAXZC3u2PdMxgiFvPEjKeapmLJMIk+Kie2Gkmc+xyryoi07XMc6VXKbhesykVsqw5ephNshbHNWe3YnnNWjOU4b0w9nRusfojEtbzQm7vTQX3L2lSGy0z1wpH20oxeYsApMMYhZviH9sTIImwDLtLqwNUGveTB3ysTzFZ6IuM7eBZvd5g2IByjQa+O/ph6ewPTXV54g+H14p0RUMEJZDH0cJzajbKNdPO5D9WEg6K+86eReG7qtneMRvHBIQPH6via82rub8uI48CLMogtEfmgvodA/gwLfMjSs5avHlhH7xMgNHtUXES6CzBvKkERckW37UicFVIXtjco/IVwu8IG4H+JBSepCi1SIxde+xgQ82WudIgsESwgWVMBdF7JpjPJ5VGl3tzkiGWGAzPg265bzeiZsGeKNmF74aFpk+nvS55ZhTChVBnvqSbQ7DUv7l/kUCATl5XoO+z4yZ+ukV9LejUkZMXxOnBwaLSWEvvWlyab9NA253RUseyYhFuaWZBJuMlTPnTMzyVcaWkWiB19CdhYzqWVZpsYuS/jiK5lpdEWF5mzrvPlEDA5Yf/8Ikl+qIoRC6Fpy8GH0kyS+AY3wmD2Y7Fxc5s2la9SgO4DYdxvTbx4BfrT5NtEi/YOwUWVSxXFunHz7gOSDbVubFFq4=
    - secure: RnAMyr4Vt5HMpY4fWM0OOGIYHq5+PQW++41m7J/nZCpJPBjRn7yDudzh+Q6BmUnZFT2QYwL16KN/56NboycQ5L+5/+XIa69nOsOwYN8aDPx1Zdj+Jnyoj/k+qHym2EPoSTpE47YLI4TtQDTgzk1/0ra/wSqGzMQpqczDJZo1zw47Xhrr+W9VxjQ873rCwpUbuc0ifbT9pbmkEZdulGcH79rfJR4RAjdv2iGEtRaU+h4hUdrp9OVYREUGqZ7Es2ScKAV44NDHngKmmO/MhmrO6FzHbOH/I8aJaQtBMjxq/mivDyhr41k+k+3FSyHlGZHjfWARugTQMmBg3mofiwAl8OW6ZjFoIvY+Q8RrWRwXmbQAScuicqa7sSSkDPF+i33+ODnuxvWEbWGmMh8Q7bwHUHurTXasDAQLFQaRUKiGJHYyWltcUe2TF+cjJEsDG3ko54lHU0tNfR9iT+UW4tZVxotHSPcpc7C5owN2ytLoRjJZZTVt2aEZcI7dnKk8pEUeD3EE+TeoP2rVk8XV2shJ1kyd26o1TK6MOfy8Kq3XBppIcJKOw5rc46IdWYw1BnPdYoM6bsKq5ETMSNUCpc9CkDxf3iT+A4Jo17X2rBHDcBgkC6M4UeKScAdkSxH2TiKZhillmUwOTGpeWqpMfWjhNdvFGAEzAVfxIRPcnFE8yT0=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
        - "./gradlew signingReport"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
