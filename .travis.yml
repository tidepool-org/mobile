env:
  global:
    - secure: WC8kH7H8yQbr7WvckZv+eDxkS9JruEUhsfWIiqwp0WMAZ48VG6cupVL8TG1De1UTWYzvxkoWxhPlrzmdZJXskynEmPtglGPSW2Pq2Hia2paY9ZmGy44dcVB+1iTtwkbqhc1qLL5lTHx8sGK7XwtRL6XzPd2nZc0MAl0vm/oB6DKyOgi0wgHzKUY/o4K77T+njgajVZjuktITfvGkXTasrJb3oLH5y1iLi/0Z7od+RZO/Hp/tHnmpFgI0xqcjegrrh162Gz1IPxRSj5PNtUUE1UjNLwMcfIv3JhOqumLSpQIi2JCd3QPtinb5xJ0TZUNy3GjP1KuWk2BSjmc9SmQWvMDedzsVCvzgDGAQqg+hQoULynheo0RqK8dm7K8SHKBHnd1aXY91gG5PptqAcki6JNdGjwJeepyRwYwzUWPTHKI/Bxc5Pev8YInfQscBh3cfAlYF9Af6HK6N6OhsWVeQjl0dO/v49bvznpfJ4H0OYxQMp9sjA8Z9iRpU/ghs6I+pucgcLlBAD8rw4ysIyPRQ+wFw+1paHz/R9ovRUSSgmrPQS+TDhxg4SEnFEfm7I8yZLxm5Ix1m3xmfFQXlRiiTc2IsS9tT+bTuhJ8vck69ANFDORFn35tgvCjQm76sj7V+TdW+vPTTxKeEz82+VZBxRrCykHZjpP/EDlr7MA229Uk=
    - secure: Eq+Cm29io7gmKKQXCdRrMjmiTgld/YNL8/A5ZPXTq8Gon0fJwr6qChS0AV48/hJdY76Sc1SUFLnyE/NxLX00fR18nzW1SUXCBzbhp2e6mYlO2luudrq1ZKcoXnnrzs+hIJ3iAiQDkuqe/RuhHBAV+Zv0hHSZI8O3j8UjWiiHPUGBg+IUNBBx5WSMFOhcp0cRSqwDwbnZiriQTMcyGLjpdMTjP6AYtjdZ3/CrimwQTYtNioCOUSq28BZBteDle6+XiaS9aWqf3aIW0scYDz9Av1bF01oxW8RUXGTbjRC/c8CZhJjrhAs5aQd1A2XwW4cqHiGprxQtub0UU3DY93Rir3q5UPmC7DjkEajpd2pJ4Yz19pUXC8xXypERCrUBuJYKDG6TGMdBwpw2bZgRi3/FbSlVR/4s0epJVbQakPnSikmYRxTFgHh/PlqA6+fOzlruaIu9HAQCdWTAJoD5GkvX2+CEoq49YPc1hH3b6ZluS100PqJRlV/t2DERJ5KksnejtUrx+A5S3e8bWesdC+30hoeypr6ayvbJ1jRf4ZfdHRonmSCwEnakNZjmSvEiD/D0EIga9ZA1BBSAOcBjI+WHH2Dn3P9y+K76v7yCBqGkzderxpE2tp13XiUOsYs48jYskDi49Cq9MYO65CS654GvA3wssv9wAmN4Y7cD2xWeC1I=
    - secure: ywPwhZ2q2PA2o9AbTlkiNIDuSmqQaFXQ1ougACLV0Xxx4vJK7ff1KA9d6Wp0qpLn3RCEcvjv3Mc4O68NG0Vu4OSJLkC1Fl1XnhKdejA2a7L6njJfl9DbhF63SFQfl/6Th2XDf6iTKwHp2sRi9kFFm4xsHNvXOJujZT6nLAaU74D+w94RJxF9+jMorVI/CY+1qe7i0Nv3UZAwrp0DvkMvHE6wIv1+UPwanVYL62DzJ70o43IQIf5HDXmEv7f1F/09bkgGwF7d+pWGtsUYN8sJCCTQAJNESqHSgoagTGbwk5OQGwoSxOYgA6GasafvT8IHBRNIVqWSH1z3GFxbh4mzyV5m6gO3uBDBjoZ8AQhA5N00N1Ye4tPumncDNISWp+tKbFdvKYLYQpsFahaV+QsLMlda07TEXGaUiByY2nLNTPhewed3r9NM6FYvtbrUApmQ5xHLiJXWX2syksR/rHTLGb3wMTRK1Yq0+3jy1Amp9wXgWAJsdpNAPgTFxwUrp+qYR+KYGohTTfRQG3Kd87RuGAd6OZlpEubOfUnB41QSSmKCQWrXyriwdHSn3KqhcErBsalUuXwf8L0yQHBpGq+pg260xRoTfsV3kJTMd+NXx1wYCoAX9ZgnnQdIBvEEZybo66DN3QLQimLl/k5XTMYHw90VBca+gdvJ4SEMK1JSue4=
    - secure: osrcVx7qTlijIQEB0sK+O5YstgcmK2JmHXsLtM2ZEokx46foftIq3F3knaUHKC9W4VZhUdhzeXCDQB/ojrkxWtIVwsfCPaBZoO4IirvSFfMmVB8XIxD0GuxKZkRInnjptbjbZZ4q5Ej8zQ30O573rrwQmWY1u+mmxHgsyAIiFnYJ7L4Cj+JCI+JFELMCrG3U4QL5Hw3mccAfSuENpKObqxidxjRNXsWBjAzZjS/MUKvmgvdlEzEWrchJzgj7UDWRIwm+tvg0dU6d70TTQyQKzZoYYwcq6nlTXXD5k30+FUL4WnzBaDRVm9p5jMK8NJBmkvp9RMuN6ius5ULs+yQs5cI1sRHXPOvt8nAZZgWpns5BD3angPqw2+oe77SkAcLEF8A7JD0xrRl9fZDjYW6K7ZPu4o3vi8hMocnMg77GcENYIO4qH37GnuTCG5orFzMwLUJcxKnT6ero0T2EpOxty/RjKjBHtyKaDYebXZHfV4AFHWm7DQFnBJKqirqqkyUsLBJOiZQkrznqK/vF03h60vNqorbPA/xAAmFpGOPuU8X7TjeZ2PwyoEQNbUtflKfbsXwNAvJeY/fB3dryeCGF9fv73o2dm1h+vv+p5mfydt5QEzXIPUH1A9Yfc/0eUEOSIwF3v1gBi4rd/jl98rM/Qvkk4fpIuNb3TF5i8yQ3EFs=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        file_glob: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/**/*.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/**/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
