env:
  global:
  - secure: 3zbx8ajAIKWXDlQN5ijm77e1/dJliWDLjRKknsmQ3AH4gTivqoo0Np+KXX6tG4TCfiizLGgU6m9SZoxiiCWOe4U4yuAR4xQhe2W8/rcXgKc8mbXtLbXrwVRBqrJJZ99fOURtJopnaxby1xHy/6vhxX6yW0ojz2VvmLdiflEjriE0udvUksGPfsmsr3A2nN3dEyaKYwVwK953AArx404H4pSJCwNPQaYjmOWDhZ1XRQGlr1ttcgGYlgmx9YU2pGZjmlmXbrITpwd+eG/jHv2kAWSJdC1KYzntNr/ETMTzuy8lnRG3BOL06n8Gx57F9hX6PS8eWMpZ3bY9BjW49SMb6ocqKbsrwrYj8r+Im1nNCAiwttmnsUtzgGdb+He1HiLPIZPEUVB9iAxH0Ny6mX8tYw7buNU/poZwRhHpUgjBzOp7bKGgvmtB5q6jNdixaDijUs8RlUixcsAt8t+LRqKPgqkTsPX8rdsTZXUlPA+v08FxJMwwREbWzBDEhMjYS8/muSmZPenR9dUbG+Mmoq4OjICE76YqAAjIzJHUkVKve/yJvqMsLWa86Qp8oah4N1jzK7rYt+ar1Wnm1PI+wXXEWGNIeC/jYAXawiJnEzXmoxUFumyR8WtqSsz+LY2rWDFbEt+TpiPfwgX6CH9F3GXzdqxx6mNs28YOGudYoPXBUNc=
  - secure: hxYBSEciPUwbvSDSkf+HMdVGbT2e48Ri9JYFTDCf8qz2AnhKVwW2lXPZ3aYijfhgtazeA4j0ZzSQYMdEvOv8eDN9gEJ1ERujZPqlEmJrP2cL4tzG+nIVsrw14gMkoftHteQFzjchKMpdNIyNfvg/+WHX6xb/QnA5Q4Ly8bTG/+wCsJiqCDfqfgHPAGKy8gnXdFFNDvJ5UtHBKo5zyKrxv1x9SX1UH6scOZWmbVsBqx897NrDjK0y/oqsU1rLLsTOvOnTk0zsYbCZYxgaajZEPT3YLpk1pfz3rTD5AGrGGojIUc15ujVuOD4tN8Lcs6BKR2mSlfo0/JSabPEW5BhYIAQReJH5VIQtGoOLhWwjR0h8PHqcOKOLqEGbswSIEfP/PjjPdK4YQ+LHvbFuspnN+uT+xscvpM85/wcWdM86oLcu5Llg6x7XRAU+xkVjb3+ljHA3iKKoiFXI9PkAZYoZJgNrqUR9JebyswM8rnOXY6rYzMDrUgNnxY+ZG9I48iM5oq5+ENQomMb85LR8FxO//okwP5oSMyMi8WqvjJFMZIQSXaDEGqNkw5OAH+ruDbVkrOoqhupvyrbqzbWQQw7ur46VoZqvPPgA0Iz0LnhXiMGitfM49GE3xgeXlQVDO2ONYpdmnE6kQDx0hUPSZUjl0+xAJlB8rzukbwV/2OJjlRE=
  - secure: XHTLtV5y0FHnI+/J5FB8BixOHIzfjov9trTqegpyJEiZUszl1IPUf0CkkCNYOrdjEu0ElntNkaZiXlLuLlfe6ZcQX4UqJEck9Z1Okhh7jQ+es197Ni41yW5CMJE0nk27FDb25nYXCCjebpMDsTOugQuF9s7mPYtsQyWfi6jj57VSzA49fxXon1aEb3Pg9dow4rIgsCvxuVvmuQT0mVALGZlWnGYOQss7xXmARnoTi8LmoN0ZEPmpoDWKC/Wir2l73kQvdunfcP8sf9GgMSsQOu/W6sgEVey8K2R6U6keQbprqH0yWNO0G3rp3CY4It+AhoPejYpscjRR7PHkdll8u6I6cMAxF1WMtAgnMVidubRzb1HlfFLY7qmni1DTQ9pyukyTxLmTPGZEI/Vt8hbPI3gqAD9ZRmpzwPwNFP3hOkqVH6aVNEXzBd8jzELDgK5VijBe3khqE4gKg7I1Vesn95YEidr8lEtXv9U8Y/c4r3hRBGaW/NW8zb9XGQdcWdGI4vl3jVTJdxigiyZzE17q8o6YabVQ2iAvx7vp487DQRApFBUN9UPbr4CdAzWxm1GE7Q+8kUPcFbXb3bZGwybCzqRG8UjwbDuF009wKQkavQj+4QiAUhlgJ/p38OhJbFpEr6XXctvexq3fsLUPNRjyVBiCADdTyBt+Xo12OObSc6g=
  - secure: WgmeznZSt3goEIJZSRy9/xm5Jj3UqLO7goTZNKC4u5G3cDoq5IbD7o3fzZwzhJS54/VKM8N/9bIpSe4odnRWdDel7QabyHZCqLhK+pOgMWKPyk4EYbOZa9IA6+Tiug965nKomhdC7PHpp8cPWd5RY67/60KEqKvMVVVk3TrfQ1I2HI/GLKLyNxjAwIXyUaZil1h5d1yMsm7gAymuxKOnj5ZSX8qCEz6bwF7ay87rIsDEz6f96FVDYk5TxkZNsnaoUqk8Z/SHFmrTFBG7F7xt7i3NllAX67vHoEIBtMbJiQ5XpHB6OB4eK+7z5UI9/bNWgKt63Y13GNep9FLP1cHyMLPu1os7FOUt4s+dFxWGbYZR4/lFLnF6JDkJhfdc5909uF/x94CA/1d0FY4WToVX9apSk3mdtOsaW3TPOLZlvVx7WdJBYPo4Okz6/HLJeCLhQ90pWRzhBohaep8vSYQ4LCyN+0cLaJf6bpV2IKWHw5TFZdDbq5eVUG/N9Eo5e2VWhGFfFg1QKr10uk7SedVd5N/0sQKIaB6VtHMwa2Wuj6FCxQudTXYeddPj0/lxSD7Z/Gjih8UpExHNlFPbbR5GInaSK9RQAn1ZYSqd1ufNEgFUu5yzcFuLHsA5DRba7oD2/vHCgYy9Dd8RUQgwrRiOJcQiGRYFYjMXD+UXVPfcCLw=
before_install:
- openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
  -in release-keystore.jks.enc -out release-keystore.jks -d
- echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
- sudo sysctl -p
- echo $TRAVIS_BUILD_DIR
- mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
- nvm install 10.15.0
- npm install expo-cli --global
- curl -o- -L https://yarnpkg.com/install.sh | bash
- export PATH="$HOME/.yarn/bin:$PATH"
- expo login -u tidepool -p $EXPO_PASSWORD
install:
- yarn install
- yarn run pre
- expo publish
matrix:
  include:
  - language: android
    jdk: oraclejdk8
    android:
      components:
      - build-tools-27.0.3
      - android-23
      - android-24
      - android-27
      - extra-google-google_play_services
      - extra-google-m2repository
      - extra-android-m2repository
      licenses:
      - android-sdk-preview-license-52d11cd2
      - android-sdk-license-.+
      - google-gdk-license-.+
    script:
    - pushd android
    - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
    - "./gradlew signingReport"
    - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
    deploy:
      provider: releases
      draft: true
      skip_cleanup: true
      overwrite: true
      api_key:
        secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
      file:
      - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
      - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
      on:
        repo: tidepool-org/mobile
        tags: true
