env:
  global:
    - secure: xBsKRAtSrALTVMStJwNG66a2Qm+pq67dTT0iz849850bqq6n1pX6QgYj0V9Qu9g98XL+DLSWUjxJs8iVYcDIa75GRHvrSREcj/K43c84ydKRjFgTNoBZP9gEPxSPtG/+mPcko8C9PtCFz33S/CnUfKOfUM53thcqMhAoKnsOptg81Qmenk5tUi3EVbzE7oUKlHV2UOVmS1CLxjZ6pcCQ/d7EKrFcFpuWhCBOf+jEgFSWJNB+weUUD9f4UotfpVcEXHfJA07ZIbXOY60kugjevTuqHzMY1LS2Sk0LZzS+A4RsG8ceO/PTlbG8xNO4djz761UR/MUz/NxZJ2l1uhd2b3ovzh27b8tHkYykDg8As5JzyWeSwph8eBB4zlTvYJRy0ibKmfy1YiKZKaz90pPpU0/61d3o39Kc5ix5vFM+5mWP9SmsgIz6p70FtTrJLzpQdKatC4pETzgZE5gI8EwBMzotQwiC5VU9DbJCdrYQSTtuURvFKIlbe2lvmkHcR92lOJCqu4aBBN2hozQ1HcMsbyJ9/bls3L1it0zxM/40OGBRH6S+dazJtBNRlWBK0F0iNuQXKPrgXLO0tzoocgB6xTs64UeR7cCzKZ//IsZfrSOMTinDBqvOiwFsMotGGvGQEIFQFuqU0EVq7Ld58RpGAIEmsTyMyzoT1h1v9FX8GIM=
    - secure: Evv1Ix0uFRUzBra/A9Es9DRwoJDD2QNN/JP+w1Q8U5oU0326RSJ6Olb7YXhfGRALOjqLCq0AtiWpB0FTrtIlu+l/2tX6awQ+XilX+B80/7EgPBo12Y1N+0/7Hg5+kqB0iE2cfOZfG7IHlwb/jHHWsRMHaVcmEJkxprYJBG0WPL4q3BICZfkxRX3ork1OYGrxFQgEB0YrhGPlhD24gABvyU4l4Ks6D8Rsyz17u70JAF6rFD9G5XbuXLBNML8nUjYkDEcWzYuFBWVtOwSpxwXJYOl4zzMpl54tNFhmMCUzv6Fqyy1Npc3gt6MgBXikixEEAlZpG9Hut1VsMoFc/NxS5pE1zf0mt/yM+VK1XfCvEVjqu0GJVr8HNMg1+bhE7FHghfQmxvMw7uplenk0hM2szOgphqj1sMo44WW+q5X2adVM+ALhjDwX5dMX6Rx1uBTPdQCAn58CXXhi/K5xjCdG1WC3VbcySbVT7BQ8azRHufj02of/AkYVchls6ht/FXXnRakC24QhRx7JkDzptEqUuULxJUgsgH7Oku8T2ryGqYggDZxCWHMPqTto/ZU7Atb5cvh9iUeO/5dcax01Sn0uyMupLWpcIWsWJU6EP2ErLkmvay3f2Bqen/zAC7b7a/pa+UWwG3pBoLLIJBBuaiZr745pFB/djj91hWsQTWFIhHE=
    - secure: UryH0WPgxH/eETj3WFaKgBe3mbMbe39RbNgUnMhzw7eX5erqFmPG6JBElwG4nq34oHkpcctpO+rL6KMgL0sXn6VuIc8W3ESXUKwSLKnXhL8sK6QOv0sMQCfYju8Ss59VXdFWdhv+Uwvqcp6nP+IalaUqNmgi1GNCKXEsigtDUTBHT+hagfwn6Y3T6NFWY6cJyoryvauAQcFYkpXGdZnyNUXOpUUhyyWEEm6TX47uZTrEJbz0NuKVYtaXLJ7fcfLAXXKs3y9WWz0iyda6b6OFke4ysn4LZ/oksHhLiqRfgprCKwqCdgf0P9jdUpDVF9WBwuGPfVlENwVrw/JrlfMC4+jTippVAmMPY+0nJtv1htBaIvU3nNw0tpMSF0+GfYwhHqck0EqFeh6wLVogx9HOLBTVndWZlsdpz8S8HIsH+9GbdaOrlBOB7rFAjsODrDiBua9QRlLSZc3nNM3bt3usi5BlkA7+Z9lVISzlbFN7u/VCCY1ryXV2iUFyYR/VqXXPJWcmD02tIuZlxNdiwqkB9ua9GjBHv6p5Ghp2QSGzpqC8Ji9V8tYQ2c4DZm/QiUkkuxeaOzOFoADrC/atVynVH4E/dulZBuvukdiUrBXrOMNzOHHnI9zKztgFQuS8edWC8K/00GKj655Cuk153CyKlMyUQQRzzx0Si9x3n/ET5k4=
    - secure: FuWneUvMS3XDbsJ7GDhgmBKgui2SHeZs6jZbl+HLhVqU8/Ob081TID6mjBfG2JmA+rqvg/WToP1W3Hd9K6gM7bivtsxjIPIHiITFgNGe6cyTooHDrxpq0Xcbk1R/FbuzFK/3tpQXKkSrRswcVy4ieV6ZRYzLkEoaXfyQslP9vZEJ9oZdGSiHlXUqcGUXacCCJY7Ix8s1i9nNTUiRg/uNWMDlBEYBWZn1+YBztwJm0zelBN7KLB3F3OKjaKHVRC4mHcsgHST+o6p0ENpM8bbR/lgspHu8qcYVvUng3UCx8tPcGfxE02BhWRlglNV7zyUYmioxyeII3UIUjz1ICz4O3eGKczlxlc/RykzLhNGjx9/sjEqvBHenC+/AbJq5VWMKj66oscQchHVHW8xmEuCCJWc4JcueBfkxeVI70h7qPHnSas3RfjMUIljYlGmu5l/TXGZT/reYcVhq4r/GGAmvSliLqWbUA8/bmFXmRe1FmilYMWZx+hxlIcFFbD1JaSjjNNbrb6ykbCDKJNsZu78lUttr0t9O23i5jGDXUkO0zcOWdq7ewnYWuzJxKcckKQTsEepEdlfDsgk8WXqAF1qwHoS22MmA4BtWNmHj0t4ipqSV5jDmxZ1a0anJCyxz/QmFiuKJ8/6hJ67pH/GkdUze0YF++svslDJ7B1ee0NKbPJU=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
        - "./gradlew signingReport"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
