env:
  global:
    - secure: v01R9Fu2vu7h6HHsqtUr6battOCbZhB2YuVo8KJtvqDeLHbfiCR3bXFi4A/qYTj0cmHsXJ0kCHsub41hxf75DaQP4ATPq7RhQkPrp8lyPsaYgOPXsG8MPLUhlA6+9yQtVMuIcY+x2KUrk3aQ8+SDZ4M83IWkP8hAAtBKVh0KPz0aiCL1O/rf5/zCnkSc4dPcB+RK2JgcV4QhB+2uDu/+5cOxUe8gzXOQfFPJw4X5ahrRnGaqwjwTGniNP0hQhyKDkBmKFLFb+ApfsT2mXihxbMjCFByECJVSJKhb5/J/JaVoIkNgxsZCeOotqh4SsAneprCiy9p8jyG18diUlHgQJ9R8peMiqG3hOTtdtdIkqUAT0cPcAqekexHXRbOdwTOear0YDlQBOShcQcPA+39qB/0WpMQvUG5betu2llTqNqzQXAKU2fe0xYmQMBjN36PGwWGkzI9Dw8zWF//NFLzLQ5ZtaYOjXk02T6Yq9B4A8fyF7CP6nIWy8aA9EDagsLzSHwr6UsubqwpVS25hwACY379osH/lzf/7eaef+TMB2ZNmY/swjIuXKHJ1V/dGny/q6nvlMUT1z5AZWLQIUJrbgWQFTTN96DXpyJyfPF+c1V1gEUFp3OkQxK7Fp79apJ8IIOYxjaBXtf1Dng3mFpIItvm4dCCxFJZjt2GcNtKXL1M=
    - secure: xhpRBrXND4P+zkKH8tfcZM7um1z5bU1H5xmNws9FeV2NC1Iys9ASfeGqG8FA3x+QsvdkCPqM3sMOBxmHdn+XvyyCllINLsXM6x3l5IAyHlPpujG3DHX321iXaPYfJ2Laj1Iaczi7FC5Izl/s05KCXIMgiutNrMzZjpfqrGLb8sL3W4uy3zNHJevHvEUU4ARmy630PJUwJTKr4dglJdkEmjOzZ3FjZdvMJ2OD2cYCkhTFDuglE4D/QURb0aDMvUMYsvP27WQllrupf+PxcyIXKJCCv0e9+M0LrsmlczT8smGzvj8WkGCK89OEO0u0YmJ6owqodloDsJgrF/hYYfpv8mpQYzo6L1cdHxJGGkkqyQvYQo5XHP3BaN3yL6sPNiX2rmXgGJuB6t8svjRKtsTwhjf6ES85McbxQpCwqgU5xu45I5A2Bf+xSs/YwnNCC3voOjKclmxZ8NRUe2q4FvtB8NX2Lm1t2KicAEFUxa/rNH8vMMJg3q+NNE1HgNCc6/nfqbVyULRlAQypdNFlFF4i2OlCF+s9xtu5smC3tD5HhHL9aYXi4PPeYzl1VqRALXPBSuBNrT+k3ZE3k3ehTVTTLozx0HH//mV96D6T87QMtLRU3UZ3ob4B2JvzUvi+Km6Y8VBqETUixBrjDSROqXaDq1uuCCHc2XRLUAS7mgnmM+I=
    - secure: VZxpIij7fo4mPE8X42tMKni+WRD8bVhjiHZpAKkvb2/dFFiotoVGioh6T/bwb8hEf/1siLsss+gYaufBQx0/Yd7QGLzOcDvF2KH1GqFxwhGzsLgEZq7nqqMlougabWwDIsWKvcvB3+ul1erkViS5CswmfBP4pZCv3FgDlPz2tXdoHMC7xqoNKBc4wft5+OJBSP+TOK3s8ZxC2OUTuEFcB+6pJMPVv5HHqPKrHXWKhlj/Ehnn6A1ca+hZIOFGwwU/y7Z7PfoXJVfViwhurdENjWsRQpf+kgJG3fp79NRMu4kOb+AX92qQXdEC3PhAKfJyo5PCIH6i6fnyNIyDkNaCsyimbyBtI0Iz/O9HH0Sray7/hwjHVHb0AaRdkbXAyOJo7sGb115OTQdGdhoSd1VkCsKVYuh8HHJ5VfcObHRDUhq6pIZP8gWtLsub+QfHBgP7OyOacheK5WV53w0De2ixh4btWnG2XSoM/TlNiipyRAeQ0aDlmT5SujIzShArz17sgUsKpY0ZnzOoift2DGHUyo/z47ZH2CME6FXS1X8Pq40O5R59BpbCV4w4Ee1CCQqcuiGIk3iLsUF22cg3fyNw8WX3mJJOH9xujQLLf3nZV2MkuexejKw2+89PBet7OAhkzxeEUI85/gNQPqcYQCKOoq2QcQoROTlP8jpFgvzBCig=
    - secure: abf/r0pl2qHOSCRZuEi3VxrtIQxAQJZUrhKIABX63+dKbltQNNHiZ4CsNpIwJcBs7+YfrxwTsMPHZ47U18csvjgIpPD8FDsVRL3SMRWD9rTR9EWG+n8ad3pE0x0E2L1UF5IT9SORuhUor1fbwXqO3mVSYszLto5uVkFtbSlU2Ekyr1h/ZOZNnxE9r00W0eMUYE8XJqea9PknNdYIqhtEUx3HYk9JotkzfAS1ZUiv2+IgAGiG5+TBH0WDnRQQjft+t3X2x3iwJ6NxCQzAsFsOvJxOeNNnGzw/Uldd+jkQb1/+6Kuutfar0jfokAAjzZq1IBD4EIqjKWVa/6JSYImPc9QPOUaLg3xAwM6UOJb3MzFKEd49k++kzDOH3kA2P0a99aoQ56yOzcRrLNhU6QLMzIMGVs6H2qrBea91K7DjY+LgtAHSOI7NnxYNlpeRNejMtYr6aS0DX9Lv5IMHTp8AkPj/oJXOM30wtXbny1pGp4E17JC6OC13bDBSy72W1pOhUEDVi6WIqErF9M57UHCP5SkRmMHqQNkuu4Fto7rSqR2D3aa+Qr/9PAX5g19V+68KRCSm4WgUfq2ywGXYpcMCBaaeaTSfBPKGuL95DseoAZDkpRLUmyDBGza3/BKT7O8u5et3rIE42BUfI17psLFWsdFc5/WZPQSocV+r0WxpgHM=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
        - "./gradlew signingReport"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
