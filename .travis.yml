env:
  global:
    - secure: lj1jUHKi6nOqBDjQV32xr7OscsepcPnx45zPujTq87Z2f+FsaRons64hbdjb52VWfEV7bPsBn8SS6tXyj/Y9xgQpc8hMNzIWBgQFmTWVnx6ITdv0v3VD19DBh8B2cz5iUNQErkqMYVGS0ymcBfAHst67T4d79bqugKmciyzcSDk9ANzoZWRJNP+DMmsy/8UG7yP1iUQ9zfzfUlGwAvGhman6WS+JTV9hK2OpSie/EbsOJ8mj4Blac6byskuRPdzruVKwbMl6zCS7jUooMEANzpeJIjWG3CRTQ8d9lpwDQe44LeDW/Tij9W7MXmVCmNOMNX5yvgyIqk6K1aR+OwH9VRnm0YNJ/ygV2l/NFB1lNIBqeUkyKCHwy45dgB2JM6Ee3IPbM5LjiHUlGb8smccmUu9Z6ibpEiSofyjF08815jtZz1vzZ5etlxLdXjvED4zEC7K1tmRrcuPqXbHlRy3smB4TD9FqxYKSRKzl31kPT7L5UUG5bcQss/DG7+P5JltVtplgwu4ypx1fbjdNwIkcV0SUIS1a0sa3tPp72ng3L0oUqrDXWzpN9ixhz5Loi2B1KWpF7l0b4jIsbpC+QvQ5svpubiUowM7o297i2DCFnlsUQXFusMKYp9EkRPoKKbv4w/Zu143Qq18BX8JtXgvWHV2vFX9GW87y1mrxbm08gXI=
    - secure: 403JPA9sGvLuwRON9eFxZIk59JFvSwuWoO4fNXcAyUmq61swezR/cyzyxNFoIEL768DmotuD7An2amDjARy874RMkYkVIl77FL12ly0aVFVPdfsoyoeWSR7LqkBGtazN5P5I0V5VDqI3YJvnxaUpnTQ93jAvs6TzKEf/tJBneyE4Avwi6oI99vgHv9Hh2ZfQdZ0LUF8EFcwF6MV76krDDlYFPTJkfVPYJF/sT2DJDKAYKhiUbovUXXkPYIebHdHXbbkW/GhOCnFKxZF7khIrjDnoTLuazhtGX/C17LDjmfr91+6AJNQhDxtqiKMgOI1j8lxMUAKQN17j4yDNlZ6Lwg04nojFBCf5BSOuwU5WePt2RwpfpVLU8JqWMRUrzAegdy1xnKY1vp47g8Yk0E6mdYV9DFksIoIqDV+yucvwy9pKJepWrSeQug71x3/DY/ZQzxoY+CTArl+rnX8yLKM9bMJudkVoZrQcNJdr7Ne0h022ahAD7UKhOfzmnPn6xo6NpMykB2fREiPtQJXey5AgU3Oqlt9I1AYOtepMnkR4s48YDdyNO+j+YS3oaU2hVl750erpC+ZGnHw0fesAqBHP7K8FY+RL8Owlv/CpVugawim7AyA5US68iOuP06xW6pi2dtsZ6pQ61/WUiX9WCWvxKxiAFsc28A8HCf9G08H2ZQI=
    - secure: qZjECLQac+26ZhPBhfGTqIShOhRS0qlC9OD9YdLypNNnH99aWmgTNfzcEZAr1ugz3PR3Sw+AFVoC3WGRopoB3o7g/qopXbT8RsdRoWvNTwkSO2G5bIe2GoUd4eECM4HIYaC7EsSfDIch/l/SWZeKXM0Qk6w+zmb4WCcYDtd5iSdXOcCWs+Cfn4WfxVKlBE4JflgUgmiV6LGRWYyiSeB8eZaZIQ0hBG9+d5gXlGX78+keFZ4icT8rVVz6vwKzb9l5EtBazUYJJZNc8TO6I0g0CA+RYpdZWqlU3ae0Hi0rp/a8n9VGbW0GL5gbBnSpPA3pa/Ovr9rvqkuvjdbnleaOkksmt5bxqRmh7ASg4jXTeKS2a6OCXKksfmMbpTem9MtVirfw3A6Ejgk/fORnF8y+3FY9Togtf35kvP/8Q87RlWSt+NxpLSny0PMnOCQLwz6zwhj5rQbPvVYXmhiz4NNraeO+eoRrMLWWyyTS6DCnFJfg3Vg2kCwncjJaxo1YCUTKCHPCIQvsGFElB62oQt00/qhW34H26KbaVPL9SJaKM7OslVmDMUKVrY6WjAxMuY4uUut8ur8LwSveNCg9ZusK8QonvEjWlPLGLsVhgJAFL5v4my4xar2LJ0Ix8/xSDmVJNYbWVGAuKQKTtOA6qpoA4CZVdxcWhbjS8O9Wio2Fu5E=
    - secure: qAZPWIs3ds3G9fcr9TtkpjdWeLpeLeZxdafn4Iz/UCdjl++trUuDnhVVSLu2bJqaIpkhcGaRwC0/e8WsBx22RWowhe66yDfcOgQ4vwkfj2CE9WKzcBAvRUxEVmcvg54saS8BtysZK6hWtAS9Ka/pyPLHbk2c+8jNKu0mNraA1gAKvEcJxthRSWA3gxDGAvuokk1vr3ezoSbv8ZjAqlObjdPFxr2xsBpPj1kA+HLfi0BDHeRZM1ICixk9riAxLNhYxFDXgwoJf83I8Dqn1AgQ+1lElyTkaeH1/ADmDv4D5Nv83agydE/Ud4qHNxh0rW8AQ3qV0n0CB5JNAHtJlciCgN2CFdy78JFNnzh5+cHeP+ekHc1wgMVghSukf+6O0YeP8zwM0tNoj3Qhaoz5Qpx1501w2bN2inSP1enArAyP9pie0wSu5zmUMIJIhuQaV3c99r/pbTD6+M2HkaHK1KXcXgusOvmjLXbH82PGFtxa+V3RwOkYlKrFtIUK7dL/h0L0FgKTvEdsPH7u0RBPjFh5WyaUfJ0DC3n6LfJhBwx97g17u3wW/GhZXk+cZ6v9mTOIudSUuDUJAlyp7D3y0ruVTW7m1e/MrdqplPj7D8DHdzV8w9sKBvl7Aqv4/LrxxWgIIN5F8UIE1bDR33XdCxeUAJ93cs57AlvXGi0fjh7JQw0=
before_install:
  - openssl aes-256-cbc -K $encrypted_4beaf9ef68f9_key -iv $encrypted_4beaf9ef68f9_iv
    -in release-keystore.jks.enc -out release-keystore.jks -d
  - echo fs.inotify.max_user_watches=524288 | sudo tee -a /etc/sysctl.conf
  - sudo sysctl -p
  - echo $TRAVIS_BUILD_DIR
  - mv $TRAVIS_BUILD_DIR/ios/Tidepool $TRAVIS_BUILD_DIR/ios/tidepool
  - nvm install 10.15.0
  - npm install expo-cli --global
  - curl -o- -L https://yarnpkg.com/install.sh | bash
  - export PATH="$HOME/.yarn/bin:$PATH"
  - expo login -u tidepool -p $EXPO_PASSWORD
install:
  - yarn install
  - yarn run pre
  - expo publish
matrix:
  include:
    - language: android
      jdk: oraclejdk8
      android:
        components:
          - build-tools-27.0.3
          - android-23
          - android-24
          - android-27
          - extra-google-google_play_services
          - extra-google-m2repository
          - extra-android-m2repository
        licenses:
          - android-sdk-preview-license-52d11cd2
          - android-sdk-license-.+
          - google-gdk-license-.+
      script:
        - pushd android
        - "./gradlew :app:assembleProdMinSdkProdKernelRelease"
        - "./gradlew signingReport"
        - "./gradlew :app:assembleDevMinSdkDevKernelDebug"
      deploy:
        provider: releases
        draft: true
        skip_cleanup: true
        overwrite: true
        api_key:
          secure: eGk21GoWqTpy7JXrYMybgGF7hb59qWCDTHR2F5MssCL4n9inAoD/5TAaTvOJjYQjqApAa0ndz8yH85GbSWW5uQDnENJiNV7vPDzFiEkKeFpniLzgQpgwdODdFaerLMiGxRzzc+tH12ZUvmmx/gtcsgJxEAtV6+1wot6ONuK9ix6kl8+yuq3/HgpdRVM/HYPsqXE6q34jFfAscOCW6GaP+xigNNvEIr3H4Ljupp6OaubPmYTgqhwq8l0rEgCiniohSJg5l1ybQ55MjYSUoLb2IRGsgLC5aE2xBlQwlOEDQtBiCIGSDt7aX/UZqIl0/UH/LkPyftT25qEyFMkFucJW4uLoG94cbbrSkVoySeU005MF212J8pxZUivoyqjmA51gENA1G/PVR9uaKdFGBhtB39Hrr6+6c8SaFyKg33HRy46soDMhQw4Cdv3gS2DfLPnUf8ITMnSNVUshr8A0EWF3v1Ykdg1oul+GZqY8EsQ9xe7OHWN9Ap7Kkt/N82JsRFzQsQSFzrvPZvdkHRVUHMiN8kRFFnTnOb5TbFoZv0m4fPapoagNghkyW0TxLtztx3DShTljbskT3H+Mv4+u5DqoGyxFEI/S7xzFEsFZkpxi3FQVL7id0GQa3/+9BBUVgm7hN8csyMcQouCYdIEQTgRhfNBNWPRYy/4BDOyHLApOtpo=
        file:
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/apk/prodMinSdkProdKernel/release/app-prodMinSdk-prodKernel-release.apk"
          - "$TRAVIS_BUILD_DIR/android/app/build/outputs/mapping/prodMinSdkProdKernel/release/mapping.txt"
        on:
          repo: tidepool-org/mobile
          tags: true
